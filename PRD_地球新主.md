# 地球新主 - 产品需求文档（PRD）

**版本：** 1.0
**日期：** 2025-12-23
**产品名称：** 地球新主（EarthLord）
**平台：** iOS

---

## 1. 产品概述

### 1.1 产品定位
地球新主是一款基于真实地理位置的末日生存类手机游戏，玩家通过真实移动来圈占领地、探索废墟、搜刮资源、建造设施，并与其他玩家进行交易和社交互动。

### 1.2 目标用户
- **核心用户：** 18-35岁，喜欢户外运动和生存类游戏的玩家
- **次要用户：** 对LBS游戏（如宝可梦GO）感兴趣的玩家
- **潜在用户：** 希望通过游戏化方式增加运动量的用户

### 1.3 产品愿景
打造一款让玩家"用脚步丈量王国"的末日生存游戏，将虚拟游戏世界与现实地理位置深度结合，创造独特的"Walk to Earn"游戏体验。

### 1.4 核心价值主张
- **真实世界融合：** GPS定位与真实地标结合
- **运动激励：** 用游戏化方式鼓励用户外出运动
- **社交连接：** 基于位置的玩家交互与协作
- **持续成长：** 丰富的成就系统和排行榜

---

## 2. 功能需求

### 2.1 用户系统模块

#### 2.1.1 登录注册（P0）
**功能描述：** 支持多种方式的用户身份认证

**需求详情：**
| 登录方式 | 优先级 | 说明 |
|---------|--------|------|
| 邮箱注册 | P0 | 用户名+密码，支持邮箱验证 |
| Apple登录 | P0 | OAuth 2.0，一键登录 |
| Google登录 | P1 | OAuth 2.0，海外用户首选 |

**验收标准：**
- 新用户可在60秒内完成注册
- 老用户可在10秒内完成登录
- 支持自动登录（Token有效期内）
- 支持密码重置功能

#### 2.1.2 个人主页（P0）
**功能描述：** 展示玩家档案和成就数据

**需求详情：**
- 显示幸存者等级
- 显示存活天数
- 显示领地数量和总面积
- 显示建筑数量
- 显示探索统计

---

### 2.2 圈地系统模块

#### 2.2.1 GPS圈地（P0）
**功能描述：** 玩家通过真实移动圈占领地

**需求详情：**
| 功能点 | 说明 |
|--------|------|
| 开始圈地 | 点击按钮后开始记录GPS轨迹 |
| 轨迹绘制 | 实时在地图上显示蓝色轨迹线 |
| 闭合检测 | 回到起点附近自动闭合成多边形 |
| 面积计算 | 自动计算圈占面积（平方米） |
| 合法性验证 | 检测是否与他人领地重叠 |

**验收标准：**
- GPS精度误差 < 10米
- 轨迹刷新频率 >= 1次/秒
- 支持最小面积限制（防止作弊）
- 闭合距离阈值可配置

#### 2.2.2 领地管理（P0）
**功能描述：** 管理已占有的领地

**需求详情：**
- 查看领地列表
- 自定义领地名称
- 查看领地面积和建筑数量
- 设置是否允许交易
- 领地活跃度检测（30天未活跃回收）

---

### 2.3 探索与资源模块

#### 2.3.1 POI发现（P0）
**功能描述：** 在真实世界地标处发现并搜刮资源

**需求详情：**
| POI类型 | 产出资源 |
|---------|----------|
| 医院/药店 | 药品（急救包、抗生素） |
| 超市/餐厅 | 食物（罐头、饮用水） |
| 工厂/工地 | 金属材料 |
| 公园/林地 | 木材 |
| 银行/珠宝店 | 稀有材料 |

**验收标准：**
- 触发距离：50米范围内
- 搜刮冷却：每个POI 24小时
- 资源产出随机性可配置

#### 2.3.2 背包系统（P1）
**功能描述：** 管理玩家收集的物资

**需求详情：**
- 背包容量限制（初始100格）
- 物品分类展示
- 物品数量堆叠
- 物品使用功能
- 本地优先架构（离线可用）

---

### 2.4 建造系统模块

#### 2.4.1 建筑建造（P0）
**功能描述：** 在领地上建造各类建筑

**建筑分类：**
| 类别 | 建筑类型 | 资源消耗示例 |
|------|----------|--------------|
| 生存类 | 篝火、庇护所 | 石头×20、木材×30 |
| 储存类 | 小仓库、中仓库 | 木材×50、金属×20 |
| 生产类 | 农田、工作台 | 木材×40、工具×5 |
| 能源类 | 太阳能板、风力发电机 | 金属×80、稀有材料×10 |

#### 2.4.2 建筑状态（P1）
**功能描述：** 建筑的状态机管理

**状态流转：**
```
建造中 → 待激活 → 运行中 → 损坏（可维修）
```

**验收标准：**
- 只有激活状态的建筑可升级
- 损坏建筑需消耗资源维修

---

### 2.5 交易系统模块

#### 2.5.1 玩家交易（P1）
**功能描述：** 玩家之间的以物易物交易

**需求详情：**
- 发布挂单（我提供/我需要）
- 基于位置发现（100米范围内可见）
- 交易匹配与确认
- 交易历史记录

---

### 2.6 通讯系统模块

#### 2.6.1 消息中心（P1）
**功能描述：** 系统消息推送

**消息类型：**
- 官方公告
- 生存指南
- 每日任务通知
- 交易提醒

#### 2.6.2 公共频道（P1）
**功能描述：** 基于位置的公共聊天

**需求详情：**
- 覆盖范围：3公里
- 实时消息推送（Supabase Realtime）
- 消息历史记录

#### 2.6.3 频道管理（P2）
**功能描述：** 创建和管理私人频道

**需求详情：**
- 创建频道
- 加入/退出频道
- 频道内聊天
- 显示在线人数

#### 2.6.4 PTT呼叫（P2）
**功能描述：** 模拟对讲机的语音消息

**需求详情：**
- 长按发送，松开结束
- 语音转文字发送
- 频率选择（公共/私人）

#### 2.6.5 通讯设备等级（P1）
**设备升级路径：**
| 设备 | 能力 | 范围 |
|------|------|------|
| 收音机 | 只收不发 | - |
| 对讲机 | 收发 | 3km |
| 营地电台 | 收发 | 10km |
| 卫星通讯 | 收发 | 全球 |

---

### 2.7 成长系统模块

#### 2.7.1 排行榜（P1）
**榜单类型：**
- 领地面积榜
- 探索废墟榜
- 建筑数量榜

**技术要求：**
- 支持10万级用户
- 5分钟缓存更新
- 显示个人排名

#### 2.7.2 成就系统（P1）
**成就分类：**
- 新手成就（引导功能）
- 进阶成就（挑战目标）
- 稀有成就（少数玩家）

**稀有度等级：** 普通 → 稀有 → 史诗 → 传说

#### 2.7.3 生存体征（P0）
**体征指标：**
| 指标 | 衰减速率 | 影响 |
|------|----------|------|
| 核心生命 | - | 降到0角色死亡 |
| 饱食度 | -5/小时 | 低于20%掉血 |
| 水分 | -10/小时 | 低于20%掉血 |

**增益机制：** 饱食度/水分 > 80% 时获得属性增益

---

### 2.8 商业化模块

#### 2.8.1 付费订阅（P0）
**订阅方案：**
| 方案 | 价格 | 权益 |
|------|------|------|
| 开拓者月卡 | $9.99/月 | 无限探索、范围扩大 |
| 领主通行证 | $19.99/月 | 所有特权 |

#### 2.8.2 一次性购买（P1）
**资源包：**
| 资源包 | 价格 |
|--------|------|
| 初级物资包 | $0.99 |
| 中级物资包 | $2.99 |
| 高级物资包 | $9.99 |

**技术要求：** 使用 StoreKit 2 框架

---

### 2.9 国际化模块

#### 2.9.1 多语言支持（P1）
**支持语言：**
- 简体中文（默认）
- 繁体中文
- English

**验收标准：**
- 切换语言后App重启生效
- 所有UI文字支持本地化

---

## 3. 非功能需求

### 3.1 性能需求
| 指标 | 要求 |
|------|------|
| 启动时间 | < 3秒 |
| 地图加载 | < 2秒 |
| GPS响应 | < 1秒 |
| 消息延迟 | < 500ms |

### 3.2 安全需求
- 用户密码加密存储
- OAuth Token安全管理
- 防GPS作弊机制
- 交易数据校验

### 3.3 可用性需求
- 本地优先架构，离线可查看背包
- 网络恢复后自动同步
- 低电量模式下GPS优化

---

## 4. 技术架构

### 4.1 前端技术栈
- **开发语言：** Swift
- **UI框架：** SwiftUI
- **地图服务：** Apple MapKit（免费）
- **定位服务：** CoreLocation

### 4.2 后端技术栈
- **后端服务：** Supabase
  - 用户认证：Supabase Auth
  - 数据库：PostgreSQL + PostGIS
  - 实时通讯：Supabase Realtime
- **支付：** StoreKit 2

### 4.3 核心代码文件
| 模块 | 核心文件 |
|------|----------|
| 登录注册 | AuthManager.swift |
| GPS圈地 | LocationManager.swift |
| 领地管理 | TerritoryManager.swift |
| POI发现 | POIManager.swift |
| 探索搜刮 | ExplorationManager.swift |
| 背包系统 | ItemManager.swift |
| 建造系统 | BuildingManager.swift |
| 交易系统 | TradeManager.swift |
| 消息中心 | RadioManager.swift |
| 实时聊天 | CommunicationManager.swift |
| 频道管理 | ChannelManager.swift |
| 内购支付 | StoreKitManager.swift |
| 排行榜 | LeaderboardManager.swift |
| 成就系统 | AchievementManager.swift |
| 生存体征 | VitalSignsManagerV2.swift |

---

## 5. 项目里程碑

| 阶段 | 功能范围 | 优先级 |
|------|----------|--------|
| MVP | 登录、圈地、探索、背包、生存体征 | P0 |
| V1.0 | 建造、交易、消息、排行榜、成就 | P1 |
| V1.5 | 频道、PTT、设备升级 | P2 |
| V2.0 | 商业化、多语言 | P0/P1 |

---

## 6. 成功指标

| 指标 | 目标值 |
|------|--------|
| 次日留存 | > 40% |
| 7日留存 | > 20% |
| 日均使用时长 | > 15分钟 |
| 付费转化率 | > 3% |
| ARPU | > $2 |

---

## 7. 风险与对策

| 风险 | 对策 |
|------|------|
| GPS作弊 | 速度检测、轨迹合理性验证 |
| 领地纠纷 | 重叠检测、先到先得原则 |
| 用户流失 | 成就系统引导、每日任务激励 |
| 续费率低 | 订阅价值持续优化 |

---

**文档维护者：** Product Team
**最后更新：** 2025-12-23
